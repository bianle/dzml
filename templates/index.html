<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script type="text/javascript" src="../static/js/jquery.js"></script>

<style>

</style>
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="main" style="height:600px;">
	
	<div class="shorter" style="text-align:center;margin:auto">
		<div style="color:#222;font-weight:bold;font-size:25px;margin:5px 0 5px 0;"><a>DZM.LA</a>&nbsp;</div>
		<div style="color:#cccccc">make your url shorter!</div>
		<div style="margin:20px 0 20px 0">
			â˜ž
			<input class="ipt" id="longUrl" type="text"  />
			<input class="btn" id='cutBtn' type="button" value="->||<-"  />
			<input class="btn" id="recoverBtn" type="button" value="|<---->|"/>
		</div>
		<br/>
		<div>
			
		</div>
		<div class="rst" id="rst" style="display:block;" onclick="selectText()"></div>
		
	</div>
	
</div>

<div style="text-align:center;margin:10px 0 0 0;font-size:12px;color:#c3c3c3">&copy;2015 dzm.la </div>
<script>
	function selectText(){
		if (document.selection) {
			var range = document.body.createTextRange();
			range.moveToElementText(document.getElementById('rst'));
			range.select();
		} else if (window.getSelection) {
			var range = document.createRange();
			range.selectNode(document.getElementById('rst'));
			window.getSelection().addRange(range);
		}
	}

	(function(jj){
	jj('#cutBtn').click(function(){
	cut();
	});
	jj("#recoverBtn").click(function(){
	recover();
	});

	function cut(){
	jj('#cutBtn').unbind('click');
	lurl = jj('#longUrl').val();
	jj.ajax({
	url:'/s/url/',
	data:{u:lurl},
	type:'post',
	dataType:'text',
	success:function(data){
	jj('#rst').html('http://dzm.la/'+data);
	jj('#cutBtn').bind('click',cut);
	}
	});
	}

	function recover(){
	jj("#recoverBtn").unbind('click');
	var key = jj('#longUrl').val().replace(/\//g,'').slice(-5);
	
	jj.ajax({
	url:'/s/url/'+key,
	data:{},
	type:'get',
	dataType:'text',
	success:function(data){
	jj('#rst').html(data);
	jj("#recoverBtn").bind('click',recover);
	}
	});
	
	}
	
	})(jQuery)
	
</script>
</body>
</html>
